# source: PRIMARY_LABEL:mr_on_actions.txt | SECONDARY_LABEL:kates_power_bloc_on_actions.txt
# change: merged; order: MR-first; объединены конфликтующие on_actions блоки с кросс-вызовами
on_game_started_after_lobby = {
	on_actions = {
		mr_on_game_started_after_lobby
		mr_pbe_game_start_integration
	}
}

# Дополнение кросс-вызовов для интеграции с Power Blocks Expanded
# Добавляется в существующий mr_on_game_started_after_lobby блок через объединение

# source: PRIMARY_LABEL:mr_on_actions.txt | SECONDARY_LABEL:kates_power_bloc_on_actions.txt
# change: merged; order: MR-first; дополнение кросс-вызовов в mr_on_game_started_after_lobby
mr_pbe_game_start_integration = {
	effect = {
		# MORGENROTE + PBE COMPATCH: Инициализация интеграции между персонажами и блоками держав
		kates_set_rule_modifier = yes
		kates_leviathan_modifier = yes
		kates_foreign_investment_agreement_pact = yes
	}
}

# source: PRIMARY_LABEL:mr_on_actions.txt | SECONDARY_LABEL:kates_power_bloc_on_actions.txt
# change: merged; order: MR-first; объединены конфликтующие on_actions блоки
on_monthly_pulse_country = {
	on_actions = {
		mr_on_monthly_pulse_country
		kates_dynamic_modifier_on_action
		delay = { days = 7 }
		kates_dynamic_modifier_on_action
		delay = { days = 14 }
		kates_dynamic_modifier_on_action
		delay = { days = 21 }
		kates_dynamic_modifier_on_action
	}
}

mr_on_monthly_pulse_country = {
	events = {
		mr.1 #Check new AI countries for variables
	}
	effect = {
		if = {
			limit = {
				c:PRC ?= this
				NOT = { has_variable = mr_paris_commune_variables_copied_var }
				exists = c:FRA
			}
			mr_copy_percentage_of_variables_commune_effect = yes
		}
		# MORGENROTE + PBE COMPATCH: Кросс-вызовы для интеграции между персонажами и блоками держав
		kates_dynamic_modifier_handler = yes
	}
}

# source: PRIMARY_LABEL:mr_on_actions.txt | SECONDARY_LABEL:kates_power_bloc_on_actions.txt
# change: merged; order: MR-first; объединены конфликтующие on_actions блоки
on_monthly_pulse = {
	on_actions = {
		mr_on_monthly_pulse
		mr_on_weekly_pulse
		kates_weekly_global_on_action
		delay = { days = 7 }
		kates_weekly_global_on_action
		delay = { days = 14 }
		kates_weekly_global_on_action
		delay = { days = 21 }
		kates_weekly_global_on_action
	}
}

mr_on_weekly_pulse = {
	effect = {
		com_run_weekly_event_country_effect = {
			weekday = 1
			on_action = mr_on_weekly_pulse_character_deaths
		}
		# MORGENROTE + PBE COMPATCH: Кросс-вызовы для интеграции между персонажами и блоками держав
		kates_weekly_global_handler = yes
	}
}

kates_dynamic_modifier_on_action = {
	effect = {
		kates_dynamic_modifier_handler = yes
	}
}

kates_weekly_global_on_action = {
	effect = {
		kates_weekly_global_handler = yes
	}
}

# source: PRIMARY_LABEL:kates_power_bloc_on_actions.txt | SECONDARY_LABEL:mr_on_actions.txt
# change: merged; order: MR-first; объединены конфликтующие on_actions блоки
on_diplomatic_play_started = {
	on_actions = {
		kates_power_bloc_revolution_on_action
	}
}

# source: PRIMARY_LABEL:kates_power_bloc_on_actions.txt | SECONDARY_LABEL:mr_on_actions.txt
# change: merged; order: MR-first; объединены конфликтующие on_actions блоки
on_wargoal_enforced = {
	on_actions = {
		kates_power_bloc_holy_war_enforced_on_action
	}
}

# Исправления для проблем с областями видимости в PBE
zz_mr_pbe_scope_fix_on_action = {
	effect = {
		# Обеспечить корректные области видимости для скриптов PBE
		every_country = {
			limit = {
				zz_mr_pbe_country_exists_trigger = yes
			}
			# Убрали ссылку на несуществующий модификатор - используем только существующие эффекты
			# Используем базовый эффект вместо модификатора
			# add_political_strength = 0.05
		}
	}
}